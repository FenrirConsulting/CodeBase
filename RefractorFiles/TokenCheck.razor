

@code {
    [CascadingParameter]
    private Task<AuthenticationState>? AuthenticationState { get; set; }

    [Inject]
    private ITokenService? TokenService { get; set; }

    [Inject]
    private NavigationManager? _NavigationManager { get; set; }

    [Inject]
    private IUserGroupService? _UserGroupService { get; set; }


    protected override async Task OnInitializedAsync()
    {

        var authState = await AuthenticationState!;
        if (authState != null && authState.User.Identity!.IsAuthenticated)
        {
            try
            {
                var User = authState.User;
                string UserId = User.FindFirst("uid")?.Value.ToString()!;
                var graphAccessToken = await TokenService!.AcquireGraphTokenAsync(UserId);
                bool setName = await _UserGroupService!.SetCurrentUserDisplayName();

                if (TokenService.UserGroupNames == null)
                {
                    _UserGroupService.SetUserGroupNames(await _UserGroupService.GetGraphApiGroupNames(UserId));
                }
            }
            catch (CustomInteractiveSignInRequiredException)
            {
                _NavigationManager!.NavigateTo("/authentication/login");
            }
        }
    }
}
